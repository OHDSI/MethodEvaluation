<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Synthesize positive controls — synthesizePositiveControls • MethodEvaluation</title><!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous"><script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css"><script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet"><script src="../pkgdown.js"></script><meta property="og:title" content="Synthesize positive controls — synthesizePositiveControls"><meta property="og:description" content="Synthesize positive controls"><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body data-spy="scroll" data-target="#toc">
    

    <div class="container template-reference-topic">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">MethodEvaluation</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">2.3.0</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav"><li>
  <a href="../reference/index.html">Reference</a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Articles
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu"><li>
      <a href="../articles/OhdsiMethodsBenchmark.html">Running the OHDSI Methods Benchmark</a>
    </li>
  </ul></li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul><ul class="nav navbar-nav navbar-right"><li>
  <a href="https://ohdsi.github.io/Hades" class="external-link"><img src='https://ohdsi.github.io/Hades/images/hadesMini.png' width=80 height=17 style='vertical-align: top;'></a>
</li>
<li>
  <a href="https://github.com/OHDSI/MethodEvaluation/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul></div><!--/.nav-collapse -->
  </div><!--/.container -->
</div><!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header">
    <h1>Synthesize positive controls</h1>
    <small class="dont-index">Source: <a href="https://github.com/OHDSI/MethodEvaluation/blob/HEAD/R/PositiveControlSynthesis.R" class="external-link"><code>R/PositiveControlSynthesis.R</code></a></small>
    <div class="hidden name"><code>synthesizePositiveControls.Rd</code></div>
    </div>

    <div class="ref-description">
    <p>Synthesize positive controls</p>
    </div>

    <div id="ref-usage">
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">synthesizePositiveControls</span><span class="op">(</span></span>
<span>  <span class="va">connectionDetails</span>,</span>
<span>  <span class="va">cdmDatabaseSchema</span>,</span>
<span>  oracleTempSchema <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  tempEmulationSchema <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"sqlRenderTempEmulationSchema"</span><span class="op">)</span>,</span>
<span>  exposureDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  exposureTable <span class="op">=</span> <span class="st">"drug_era"</span>,</span>
<span>  outcomeDatabaseSchema <span class="op">=</span> <span class="va">cdmDatabaseSchema</span>,</span>
<span>  outcomeTable <span class="op">=</span> <span class="st">"cohort"</span>,</span>
<span>  outputDatabaseSchema <span class="op">=</span> <span class="va">outcomeDatabaseSchema</span>,</span>
<span>  outputTable <span class="op">=</span> <span class="va">outcomeTable</span>,</span>
<span>  createOutputTable <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  <span class="va">exposureOutcomePairs</span>,</span>
<span>  modelType <span class="op">=</span> <span class="st">"poisson"</span>,</span>
<span>  minOutcomeCountForModel <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  minOutcomeCountForInjection <span class="op">=</span> <span class="fl">25</span>,</span>
<span>  minModelCount <span class="op">=</span> <span class="fl">5</span>,</span>
<span>  covariateSettings <span class="op">=</span> <span class="fu">FeatureExtraction</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/FeatureExtraction/man/createCovariateSettings.html" class="external-link">createCovariateSettings</a></span><span class="op">(</span>useDemographicsAgeGroup</span>
<span>    <span class="op">=</span> <span class="cn">TRUE</span>, useDemographicsGender <span class="op">=</span> <span class="cn">TRUE</span>, useDemographicsIndexYear <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useDemographicsIndexMonth <span class="op">=</span> <span class="cn">TRUE</span>, useConditionGroupEraLongTerm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useDrugGroupEraLongTerm <span class="op">=</span> <span class="cn">TRUE</span>, useProcedureOccurrenceLongTerm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>    useMeasurementLongTerm <span class="op">=</span> <span class="cn">TRUE</span>, useObservationLongTerm <span class="op">=</span> <span class="cn">TRUE</span>, useCharlsonIndex <span class="op">=</span></span>
<span>    <span class="cn">TRUE</span>, useDcsi <span class="op">=</span> <span class="cn">TRUE</span>, useChads2Vasc <span class="op">=</span> <span class="cn">TRUE</span>, longTermStartDays <span class="op">=</span> <span class="fl">365</span>, endDays <span class="op">=</span> <span class="fl">0</span><span class="op">)</span>,</span>
<span>  prior <span class="op">=</span> <span class="fu">Cyclops</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Cyclops/man/createPrior.html" class="external-link">createPrior</a></span><span class="op">(</span><span class="st">"laplace"</span>, exclude <span class="op">=</span> <span class="fl">0</span>, useCrossValidation <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span>,</span>
<span>  control <span class="op">=</span> <span class="fu">Cyclops</span><span class="fu">::</span><span class="fu"><a href="https://rdrr.io/pkg/Cyclops/man/createControl.html" class="external-link">createControl</a></span><span class="op">(</span>cvType <span class="op">=</span> <span class="st">"auto"</span>, startingVariance <span class="op">=</span> <span class="fl">0.1</span>, seed <span class="op">=</span> <span class="fl">1</span>,</span>
<span>    resetCoefficients <span class="op">=</span> <span class="cn">TRUE</span>, noiseLevel <span class="op">=</span> <span class="st">"quiet"</span>, threads <span class="op">=</span> <span class="fl">10</span><span class="op">)</span>,</span>
<span>  firstExposureOnly <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  washoutPeriod <span class="op">=</span> <span class="fl">183</span>,</span>
<span>  riskWindowStart <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  riskWindowEnd <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  endAnchor <span class="op">=</span> <span class="st">"cohort end"</span>,</span>
<span>  addIntentToTreat <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  firstOutcomeOnly <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  removePeopleWithPriorOutcomes <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  maxSubjectsForModel <span class="op">=</span> <span class="fl">1e+05</span>,</span>
<span>  effectSizes <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">1</span>, <span class="fl">1.25</span>, <span class="fl">1.5</span>, <span class="fl">2</span>, <span class="fl">4</span><span class="op">)</span>,</span>
<span>  precision <span class="op">=</span> <span class="fl">0.01</span>,</span>
<span>  outputIdOffset <span class="op">=</span> <span class="fl">1000</span>,</span>
<span>  workFolder <span class="op">=</span> <span class="st">"./SignalInjectionTemp"</span>,</span>
<span>  cdmVersion <span class="op">=</span> <span class="st">"5"</span>,</span>
<span>  modelThreads <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  generationThreads <span class="op">=</span> <span class="fl">1</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div id="arguments">
    <h2>Arguments</h2>
    <dl><dt>connectionDetails</dt>
<dd><p>An R object of type <code>ConnectionDetails</code> created using
the function <code>createConnectionDetails</code> in the
<code>DatabaseConnector</code> package.</p></dd>


<dt>cdmDatabaseSchema</dt>
<dd><p>Name of database schema that contains OMOP CDM and
vocabulary.</p></dd>


<dt>oracleTempSchema</dt>
<dd><p>DEPRECATED: use `tempEmulationSchema` instead.</p></dd>


<dt>tempEmulationSchema</dt>
<dd><p>Some database platforms like Oracle and Impala do not truly support temp tables. To
emulate temp tables, provide a schema with write privileges where temp tables
can be created.</p></dd>


<dt>exposureDatabaseSchema</dt>
<dd><p>The name of the database schema that is the location where
the exposure data used to define the exposure cohorts is
available.  If exposureTable = DRUG_ERA,
exposureDatabaseSchema is not used by assumed to be
cdmSchema.  Requires read permissions to this database.</p></dd>


<dt>exposureTable</dt>
<dd><p>The table name that contains the exposure cohorts.  If
exposureTable &lt;&gt; DRUG_ERA, then expectation is exposureTable
has format of COHORT table: cohort_concept_id, SUBJECT_ID,
COHORT_START_DATE, COHORT_END_DATE.</p></dd>


<dt>outcomeDatabaseSchema</dt>
<dd><p>The name of the database schema that is the location where
the data used to define the outcome cohorts is available. If
exposureTable = CONDITION_ERA, exposureDatabaseSchema is not
used by assumed to be cdmSchema.  Requires read permissions
to this database.</p></dd>


<dt>outcomeTable</dt>
<dd><p>The table name that contains the outcome cohorts. When the
table name is not CONDITION_ERA This table is expected to
have the same format as the COHORT table: SUBJECT_ID,
COHORT_START_DATE, COHORT_END_DATE, COHORT_CONCEPT_ID (CDM
v4) or COHORT_DEFINITION_ID (CDM v5 and higher).</p></dd>


<dt>outputDatabaseSchema</dt>
<dd><p>The name of the database schema that is the location of the
tables containing the new outcomesRequires write permissions
to this database.</p></dd>


<dt>outputTable</dt>
<dd><p>The name of the table names that will contain the generated
outcome cohorts.</p></dd>


<dt>createOutputTable</dt>
<dd><p>Should the output table be created prior to inserting the
outcomes? If TRUE and the tables already exists, it will
first be deleted. If FALSE, the table is assumed to exist and
the outcomes will be inserted. Any existing outcomes with the
same IDs will first be deleted.</p></dd>


<dt>exposureOutcomePairs</dt>
<dd><p>A data frame with at least two columns:</p><ul><li><p>"exposureId" containing the drug_concept_ID or
        cohort_concept_id of the exposure variable</p></li>
<li><p>"outcomeId" containing the condition_concept_ID or
        cohort_concept_id of the outcome variable</p></li>
</ul></dd>


<dt>modelType</dt>
<dd><p>Can be either "poisson" or "survival"</p></dd>


<dt>minOutcomeCountForModel</dt>
<dd><p>Minimum number of outcome events required to build a model.</p></dd>


<dt>minOutcomeCountForInjection</dt>
<dd><p>Minimum number of outcome events required to inject a signal.</p></dd>


<dt>minModelCount</dt>
<dd><p>Minimum number of negative controls having enough outcomes to
fit an outcome model.</p></dd>


<dt>covariateSettings</dt>
<dd><p>An object of type <code>covariateSettings</code> as created using
the <code>createCovariateSettings</code> function in the
<code>FeatureExtraction</code> package.</p></dd>


<dt>prior</dt>
<dd><p>The prior used to fit the outcome model. See
<code><a href="https://rdrr.io/pkg/Cyclops/man/createPrior.html" class="external-link">createPrior</a></code> for details.</p></dd>


<dt>control</dt>
<dd><p>The control object used to control the cross-validation used
to determine the hyperparameters of the prior (if
applicable). See <code><a href="https://rdrr.io/pkg/Cyclops/man/createControl.html" class="external-link">createControl</a></code> for
details.</p></dd>


<dt>firstExposureOnly</dt>
<dd><p>Should signals be injected only for the first exposure? (ie.
assuming an acute effect)</p></dd>


<dt>washoutPeriod</dt>
<dd><p>Number of days at the start of observation for which no
signals will be injected, but will be used to determine
whether exposure or outcome is the first one, and for
extracting covariates to build the outcome model.</p></dd>


<dt>riskWindowStart</dt>
<dd><p>The start of the risk window relative to the start of the
exposure (in days). When 0, risk is assumed to start on the
first day of exposure.</p></dd>


<dt>riskWindowEnd</dt>
<dd><p>The end of the risk window (in days) relative to the endAnchor.</p></dd>


<dt>endAnchor</dt>
<dd><p>The anchor point for the end of the risk window. Can be
"cohort start" or "cohort end".</p></dd>


<dt>addIntentToTreat</dt>
<dd><p>If true, the signal will not only be injected in the primary
time at risk, but also after the time at risk (up until the
obseration period end). In both time periods, the target
effect size will be enforced. This allows the same positive
control synthesis to be used in both on treatment and
intent-to-treat analysis variants. However, this will
preclude the controls to be used in self-controlled designs
that consider the time after exposure. Requires
<code>firstExposureOnly = TRUE</code>.</p></dd>


<dt>firstOutcomeOnly</dt>
<dd><p>Should only the first outcome per person be considered when
modeling the outcome?</p></dd>


<dt>removePeopleWithPriorOutcomes</dt>
<dd><p>Remove people with prior outcomes?</p></dd>


<dt>maxSubjectsForModel</dt>
<dd><p>Maximum number of people used to fit an outcome model.</p></dd>


<dt>effectSizes</dt>
<dd><p>A numeric vector of effect sizes that should be inserted.</p></dd>


<dt>precision</dt>
<dd><p>The allowed ratio between target and injected signal size.</p></dd>


<dt>outputIdOffset</dt>
<dd><p>What should be the first new outcome ID that is to be
created?</p></dd>


<dt>workFolder</dt>
<dd><p>Path to a folder where intermediate data will be stored.</p></dd>


<dt>cdmVersion</dt>
<dd><p>Define the OMOP CDM version used: currently support "4" and
"5".</p></dd>


<dt>modelThreads</dt>
<dd><p>Number of parallel threads to use when fitting outcome
models.</p></dd>


<dt>generationThreads</dt>
<dd><p>Number of parallel threads to use when generating outcomes.</p></dd>

</dl></div>
    <div id="value">
    <h2>Value</h2>
    

<p>A data.frame listing all the drug-pairs in combination with requested effect sizes and the real
inserted effect size (might be different from the requested effect size because of sampling error).</p>
    </div>
    <div id="details">
    <h2>Details</h2>
    <p>This function will insert additional outcomes for a given set of drug-outcome pairs. It is assumed
that these drug-outcome pairs represent negative controls, so the true relative risk before
inserting any outcomes should be 1. There are two models for inserting the outcomes during the
specified risk window of the drug: a Poisson model assuming multiple outcomes could occurr during a
single exposure, and a survival model considering only one outcome per exposure.
It is possible to use bulk import to insert the generated outcomes in the database. This requires
the environmental variable 'USE_MPP_BULK_LOAD' to be set to 'TRUE'. See <code><a href="https://ohdsi.github.io/DatabaseConnector/reference/insertTable.html" class="external-link">
?DatabaseConnector::insertTable</a></code> for details on how to configure the bulk upload.</p>
    </div>
    <div id="references">
    <h2>References</h2>
    <p>Schuemie MJ, Hripcsak G, Ryan PB, Madigan D, Suchard MA. Empirical confidence interval calibration
for population-level effect estimation studies in observational healthcare data. Proc Natl Acad Sci
U S A. 2018 Mar 13;115(11):2571-2577.</p>
    </div>

  </div>
  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <nav id="toc" data-toggle="toc" class="sticky-top"><h2 data-toc-skip>Contents</h2>
    </nav></div>
</div>


      <footer><div class="copyright">
  <p></p><p>Developed by Martijn Schuemie.</p>
</div>

<div class="pkgdown">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer></div>

  


  

  </body></html>

